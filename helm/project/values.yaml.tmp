# Default values for etandem.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

name: "ulep"
domain: ulep.thestaging.io
issuerName: letsencrypt

apiUrl: &apiUrl api
adminUrl: &adminUrl admin
keycloakUrl: &keycloakUrl auth
webappUrl: &webappUrl webapp
keycloakAdminPassword: &keycloakAdminPassword AZE123aze
keycloakClientSecret: &keycloakClientSecret bN49BuApmmtAODeOWOG8iKOOuJdN3KE6
minioAccessKey: &minioAccessKey minio
minioSecretKey: &minioSecretKey AZE123aze
firebaseProjectId: &firebaseProjectId firebase-project-id ##CHANGE THIS
firebasePrivateKey: &firebasePrivateKey firebase-private-key ##CHANGE THIS WITH -----BEGIN PRIVATE KEY-----\nPRIVATE KEY\n-----END PRIVATE KEY-----
firebaseClientEmail: &firebaseClientEmail firebase-client-email ##CHANGE THIS

api:
  name: api
  replicaCount: 1
  image:
    repository: rg.fr-par.scw.cloud/ulep/api-prod
    tag: '1.0.1496'
    pullPolicy: Always
  initImage:
    repository: rg.fr-par.scw.cloud/ulep/api-init
    tag: '1.0.1496'
    pullPolicy: Always
  env:
    adminUrl: *adminUrl
    appUrl: *webappUrl
    logLevel: warn
    defaultTranslationLanguage: fr
    keycloakRealm: etandem
    keycloakAdmin: admin
    keycloakClientId: api
    keycloakClientSecret: *keycloakClientSecret
    keycloakAdminRoleName: admin
    minioUrl: https://minio-api.ulep.thestaging.io
    minioAccessKey: *minioAccessKey
    minioSecretKey: *minioSecretKey
    weblateApiUrl: https://weblate.ulep.thestaging.io/api # TO CHANGE
    weblateApiToken: # required
    connectorUrl: https://auth.ulep.thestaging.io
    connectorToken: 5f8a2b8c-8b0a-4b9e-9b0a-4b9e9b0a4b9e
    emailsAssetsBucket: assets
    notificationAssetsBucket: assets
    emailsTranslationsComponent: emails
    emailsAssetsPublicEndpoint: *minioUrl
    notificationAssetsPublicEndpoint: *minioUrl
    appLinkAppleStore: https://www.apple.com/fr/app-store/etandem
    appLinkPlayStore: https://play.google.com/store/apps/etandem
    smtpDisableBootVerification: false
    smtpHost: mailcatcher
    smtpPort: 1025
    smtpSecure: false
    smtpIgnoreTLS: true
    smtpSender: contact@ulep.fr
    firebaseProjectId: *firebaseProjectId
    firebasePrivateKey: *firebasePrivateKey
    firebaseClientEmail: *firebaseClientEmail
    firebaseParallelLimit: 3
    sentryDsn: https://3306ec4562fb4cfab0be7feaf5bf136a@glitchtip.ulep.thestaging.io/1
    cancelTresholdInMin: 15
    signedUrlExpirationInSeconds: 3600
    notificationTranslationNamespace:
    notificationAssetsBucket:
    notificationAssetsPublicEndpoint:


  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80
  service:
    type: ClusterIP
    port: 80
  probes:
    readiness:
      initialDelaySeconds: 0
      periodSeconds: 10
      failureThreshold: 6
    liveness:
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 5
  ingress:
    enabled: true
    className: traefik
    annotations:
      kubernetes.io/ingress.class: "traefik"
      cert-manager.io/cluster-issuer: "letsencrypt"
      kubernetes.io/tls-acme: "true"
    hosts:
      - host: *apiUrl
        paths: [/]
    tls:
      - hosts:
          - *apiUrl

auth:
  name: "auth"
  replicaCount: 1
  image:
    repository: "quay.io/keycloak/keycloak"
    tag: "21.1"
    pullPolicy: IfNotPresent
  initImage:
    repository: "rg.fr-par.scw.cloud/ulep/auth-prod"
    tag: "1.0.1496"
  env:
    keycloakAdmin: admin
    keycloakAdminPassword: *keycloakAdminPassword
    kcDB: postgres
    kcDBSchema: keycloak
    proxyAddressForwarding: true
    logLevel: DEBUG
    sentryDsn: https://f16c3018310045fe9a5fa2c47f437921@glitchtip.ulep.thestaging.io/5
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80
  service:
    type: ClusterIP
    port: 80
  probes:
    startup:
      initialDelaySeconds: 10
      periodSeconds: 10
      failureThreshold: 12
    readiness:
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 10
    liveness:
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 5
  ingress:
    enabled: true
    className: traefik
    annotations:
      kubernetes.io/ingress.class: "traefik"
      cert-manager.io/cluster-issuer: "letsencrypt"
      kubernetes.io/tls-acme: "true"
    hosts:
      - host: *keycloakUrl
        paths: [/]
    tls:
      - hosts:
          - *keycloakUrl

# Full configuration: https://github.com/bitnami/charts/tree/master/bitnami/postgresql
postgresql:
  global:
    postgresql:
      auth:
        username: "ulep"
        password: "AZE123aze"
        database: "ulep"
  primary:
    initdb:
      scriptsConfigMap: ulep-init-database
    persistence:
      size: 8Gi

minio:
  global:
    storageClass: scw-bssd
  image:
    tag: 2023.9.30-debian-11-r0
  clientImage:
    tag: 2023.9.29-debian-11-r0
  auth:
    rootUser: *minioAccessKey
    rootPassword: *minioSecretKey
  persistence:
    size: 8Gi
  # Distributed  mode is recommended for PROD
  mode: distributed
  statefulset:
    replicaCount: 2
    drivesPerNode: 2
  ingress:
    enabled: true
    ingressClassName: traefik
    hostname: minio.ulep.thestaging.io
    path: /
    pathType: Prefix
    servicePort: 9001
    annotations:
      kubernetes.io/ingress.class: "traefik"
      cert-manager.io/cluster-issuer: "letsencrypt"
      kubernetes.io/tls-acme: "true"
    tls: true
    extraTls:
      - hosts:
         - minio.ulep.thestaging.io
        secretName: minio
  apiIngress:
    enabled: true
    ingressClassName: traefik
    hostname: minio-api.ulep.thestaging.io
    path: /
    pathType: Prefix
    servicePort: 9000
    annotations:
      kubernetes.io/ingress.class: "traefik"
      cert-manager.io/cluster-issuer: "letsencrypt"
      kubernetes.io/tls-acme: "true"
    tls: true
    extraTls:
      - hosts:
         - minio-api.ulep.thestaging.io
        secretName: minio-api

admin:
  name: "admin"
  replicaCount: 1
  image:
    repository: "rg.fr-par.scw.cloud/ulep/admin-prod"
    tag: "1.0.1496"
    pullPolicy: IfNotPresent
  env:
    keycloakClientSecret: *keycloakClientSecret
    sentryDsn: https://56e3c8db64eb4dce8edd825a0ddd7a8c@glitchtip.ulep.thestaging.io/2
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80
  service:
    type: ClusterIP
    port: 80
  probes:
    startup:
      initialDelaySeconds: 60
      periodSeconds: 30
      failureThreshold: 5
    readiness:
      initialDelaySeconds: 0
      periodSeconds: 10
      failureThreshold: 3
    liveness:
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 3
  ingress:
    enabled: true
    className: traefik
    annotations:
      kubernetes.io/ingress.class: "traefik"
      cert-manager.io/cluster-issuer: "letsencrypt"
      kubernetes.io/tls-acme: "true"
    hosts:
      - host: *adminUrl
        paths: [/]
    tls:
      - hosts:
          - *adminUrl

webapp:
  name: "webapp"
  replicaCount: 1
  image:
    repository: nginx
    tag: '1.25.2-alpine'
    pullPolicy: IfNotPresent
  initImage:
    repository: "rg.fr-par.scw.cloud/ulep/webapp"
    tag: "1.0.1496"
    pullPolicy: IfNotPresent
  env:
    viteEnv: staging
    viteSentryDsn: https://e60e318600f44d14b015b9935ed0a793@glitchtip.ulep.thestaging.io/4
  pv:
    storage: 4Gi
    storageClassName: scw-bssd
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 100
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80
  service:
    type: ClusterIP
    port: 80
  probes:
    startup:
      initialDelaySeconds: 30
      periodSeconds: 10
      failureThreshold: 15
    readiness:
      initialDelaySeconds: 0
      periodSeconds: 10
      failureThreshold: 3
    liveness:
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 3
  ingress:
    enabled: true
    className: traefik
    annotations:
      kubernetes.io/ingress.class: "traefik"
      cert-manager.io/cluster-issuer: "letsencrypt"
      kubernetes.io/tls-acme: "true"
    hosts:
      - host: *webappUrl
        paths: [/]
    tls:
      - hosts:
          - *webappUrl

chat:
  name: 'chat'
  replicaCount: 1
  image:
    repository: 'rg.fr-par.scw.cloud/ulep/chat-prod'
    tag: '1.0.2397'
    pullPolicy: IfNotPresent
  env:
    mongoInitUser: 'root'
    mongoInitPassword: 'AZE123aze'
    mongoInitDatabase: 'ulep'
    mongoUser: 'ulep'
    mongoPassword: 'AZE123aze'
    mongoDatabase: 'ulep'
    mongoLogLevel: 'debug'
  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 2
    targetCPUUtilizationPercentage: 80
  service:
    type: ClusterIP
    port: 80
    wsPort: 8080
    appPort: 3000
    appPortWs: 5000
  probes:
    readiness:
      initialDelaySeconds: 0
      periodSeconds: 10
      failureThreshold: 6
    liveness:
      initialDelaySeconds: 0
      periodSeconds: 5
      failureThreshold: 5
  ingress:
    enabled: true
    className: traefik
    annotations:
      kubernetes.io/ingress.class: 'traefik'
      cert-manager.io/cluster-issuer: 'letsencrypt'
      kubernetes.io/tls-acme: 'true'
    hosts:
      - host: chat
        paths: [/]
    tls:
      - hosts:
          - chat

mongodb:
  image:
    debug: true
    pullPolicy: Always
  architecture: replicaset
  replicaCount: 1
  persistence:
    size: 8Gi
  auth:
    rootUser: 'root'
    rootPassword: 'AZE123aze'
    usernames: ['ulep']
    passwords: ['AZE123aze']
    databases: ['ulep']
  initdbScriptsConfigMap: ulep-mongo-postinstall-configmap

redis:
  pullPolicy: IfNotPresent
  replicaCount: 1
  persistence:
    size: 8Gi
  auth:
    enabled: false

jitsi-meet:
  name: 'jitsi'
  publicURL: 'https://jitsi.ulep.thestaging.io'
  enableAuth: true
  enableGuests: false
  tz: Europe/Paris

  web:
    ingress:
      enabled: true
      className: traefik
      annotations:
        kubernetes.io/ingress.class: traefik
        cert-manager.io/cluster-issuer: 'letsencrypt'
        kubernetes.io/tls-acme: 'true'
        traefik.ingress.kubernetes.io/router.entrypoints: 'websecure'
      hosts:
        - host: 'jitsi.ulep.thestaging.io'
          paths: ['/']
      tls:
        - secretName: jitsi-tls
          hosts:
            - 'jitsi.ulep.thestaging.io'
    extraVolumes:
      - name: 'jitsi-meet-swp'
        configMap:
          name: 'jitsi-meet-swp'
          items:
            - key: 'custom-config.js'
              path: 'custom-config.js'
            - key: 'custom-interface_config.js'
              path: 'custom-interface_config.js'
    extraVolumeMounts:
      - name: 'jitsi-meet-swp'
        mountPath: '/config/custom-config.js'
        subPath: 'custom-config.js'
      - name: 'jitsi-meet-swp'
        mountPath: '/config/custom-interface_config.js'
        subPath: 'custom-interface_config.js'

  jvb:
    UDPPort: 30378
    useHostPort: true
    publicIPs:
      - 51.159.157.213
    # useNodeIP: true
    service:
      enabled: true
      type: LoadBalancer
    securityContext:
      allowPrivilegeEscalation: false
      seccompProfile:
        type: 'RuntimeDefault'
      readOnlyRootFilesystem: false
      runAsNonRoot: false

  prosody:
    persistence:
      enabled: false
    extraEnvs:
      - name: 'AUTH_TYPE'
        value: 'jwt'
      - name: 'JWT_APP_ID'
        value: 'api'
      - name: 'JWT_APP_SECRET'
        value: 'bN49BuApmmtAODeOWOG8iKOOuJdN3KE6'
    securityContext:
      allowPrivilegeEscalation: false
      seccompProfile:
        type: 'RuntimeDefault'
      readOnlyRootFilesystem: false
      runAsNonRoot: false

  jibri:
    enable: false

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

imagePullSecrets:
  - name: "registrypullsecret"

nameOverride: ""
fullnameOverride: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 2000

securityContext: {}
  # capabilities:
  #   drop:
  #   - ALL
  # readOnlyRootFilesystem: true
  # runAsNonRoot: true
  # runAsUser: 1000


resources: {}

nodeSelector: {}

tolerations: []

affinity: {}
