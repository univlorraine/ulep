datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

model User {
  id                    String              @id
  email                 String              @unique
  profile               Profile?
  reports               Report[]

  @@map("users")
}

model Profile {
  id                    String              @id @default(uuid())
  user                  User                @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId                String              @unique
  firstname             String
  lastname              String
  birthdate             DateTime
  gender                Gender
  role                  Role
  metadata              Json // availability, goals, meetingFrequency, department, diploma, bio, interests, etc.
  organization          Organization        @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  organizationId        String
  nationality           CountryCode         @relation(fields: [nationalityId], references: [id])
  nationalityId         String
  avatar                MediaObject?
  nativeLanguage        NativeLanguage?
  learningLanguage      LearningLanguage?
  // tandems               ProfileTandem[]
  createdAt             DateTime            @default(now())
}

model LanguageCode {
  id                    String              @id @default(uuid())
  code                  String              @unique
  name                  String
  isEnable              Boolean             @default(true)
  nativeLanguages       NativeLanguage[]
  learningLanguages     LearningLanguage[]
  createdAt             DateTime            @default(now())
}

model NativeLanguage {
  id                    String              @id @default(uuid())
  profile               Profile             @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId             String              @unique
  languageCode          LanguageCode        @relation(fields: [languageCodeId], references: [id], onDelete: Cascade)
  languageCodeId        String
  createdAt             DateTime            @default(now())

  @@unique([profileId, languageCodeId])
}

model LearningLanguage {
  id                    String              @id @default(uuid())
  profile               Profile             @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId             String              @unique
  languageCode          LanguageCode        @relation(fields: [languageCodeId], references: [id], onDelete: Cascade)
  languageCodeId        String
  proficiencyLevel      String
  createdAt             DateTime            @default(now())

  @@unique([profileId, languageCodeId])
}

model CountryCode {
  id                    String              @id @default(uuid())
  code                  String              @unique
  name                  String
  profiles              Profile[]
  organizations         Organization[]
  createdAt             DateTime            @default(now())
}

// model Tandem {
//   id                    String              @id @default(uuid())
//   profiles              ProfileTandem[]
//   isActive              Boolean
//   createdAt             DateTime            @default(now())
// }

// model ProfileTandem {
//   profileId             String              @id
//   tandemId              String
//   profile               Profile             @relation(fields: [profileId], references: [id], onDelete: Cascade)
//   tandem                Tandem              @relation(fields: [tandemId], references: [id], onDelete: Cascade)
//   createdAt             DateTime            @default(now())
// }

model Organization {
  id                    String              @id @default(uuid())
  profiles              Profile[]
  name                  String              @unique
  country               CountryCode         @relation(fields: [countryId], references: [id])
  countryId             String
  timezone              String
  admissionStart        DateTime
  admissionEnd          DateTime
  createdAt             DateTime            @default(now())
}

model MediaObject {
  id                    String              @id @default(uuid())
  name                  String
  bucket                String
  mime                  String
  size                  Int
  createdAt             DateTime            @default(now())
  profile               Profile             @relation(fields: [profileId], references: [id], onDelete: Cascade)
  profileId             String              @unique
}

model Report {
  id                    String              @id @default(uuid())
  content               String
  categoryId            String
  userId                String
  category              ReportCategory      @relation(fields: [categoryId], references: [id])
  user                  User                @relation(fields: [userId], references: [id])
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt

  @@map("reports")
}

model ReportCategory {
  id                    String              @id @default(uuid())
  name                  String              @unique
  reports               Report[]            // Category to Reports relation, one category can have many reports

  @@map("report_categories")
}

enum Role {
  STAFF
  STUDENT
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum Goal {
  SPEAK_LIKE_NATIVE
  IMPROVE_LEVEL
  ORAL_PRACTICE
  PREPARE_TRAVEL_ABROAD
  GET_CERTIFICATION
}

enum MeetingFrequency {
  ONCE_A_WEEK
  TWICE_A_WEEK
  THREE_TIMES_A_WEEK
  TWICE_A_MONTH
  THREE_TIMES_A_MONTH
}
